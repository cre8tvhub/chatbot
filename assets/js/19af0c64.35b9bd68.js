"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1538],{80600:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var t=o(85893),a=o(11151);const i={},r="Configure the Evaluation CLI",s={id:"evaluation/index",title:"Configure the Evaluation CLI",description:"The MongoDB Chatbot Framework comes with an Evaluation CLI that allows you",source:"@site/docs/evaluation/index.md",sourceDirName:"evaluation",slug:"/evaluation/",permalink:"/chatbot/evaluation/",draft:!1,unlisted:!1,editUrl:"https://github.com/mongodb/chatbot/tree/main/docs/docs/evaluation/index.md",tags:[],version:"current",frontMatter:{},sidebar:"main",previous:{title:"Chatbot UI",permalink:"/chatbot/ui"},next:{title:"CLI Command Reference",permalink:"/chatbot/evaluation/command-reference"}},l={},c=[{value:"How It Works",id:"how-it-works",level:2},{value:"Install",id:"install",level:2},{value:"Create a Configuration File",id:"create-a-configuration-file",level:2},{value:"Define Configuration Files with TypeScript",id:"define-configuration-files-with-typescript",level:2},{value:"Example Configuration",id:"example-configuration",level:2},{value:"Additional Example Configurations",id:"additional-example-configurations",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"configure-the-evaluation-cli",children:"Configure the Evaluation CLI"}),"\n",(0,t.jsx)(n.p,{children:"The MongoDB Chatbot Framework comes with an Evaluation CLI that allows you\nto evaluate the performance of your chatbot and its components."}),"\n",(0,t.jsx)(n.p,{children:"Evaluation is important to ensure that the chatbot is providing accurate and relevant responses to user queries.\nIt also helps you measure the effect of changes to the chatbot's components\nas you develop your application."}),"\n",(0,t.jsx)(n.p,{children:"The CLI evaluates the chatbot's performance by comparing the chatbot's responses to a set of questions with the expected answers."}),"\n",(0,t.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,t.jsx)(n.p,{children:"The Evaluation CLI works by running a series of commands that generate, evaluate, and report on the performance of your chatbot."}),"\n",(0,t.jsx)(n.p,{children:"Here's a high-level overview of the process:"}),"\n",(0,t.jsx)(n.mermaid,{value:"graph LR\n  generate[Generate] --\x3e evaluate[Evaluate]\n  evaluate --\x3e report[Report]"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Generate Data"}),": Generate data for evaluation. You can pull data from test cases files, databases, or APIs. Generated data outputs to a ",(0,t.jsx)(n.code,{children:"GeneratedDataStore"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Evaluate Data"}),": Evaluate the generated data. You can evaluate the quality, faithfulness, and other aspects of the data. Evaluation outputs to the ",(0,t.jsx)(n.code,{children:"EvaluationStore"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Report on Data"}),": Generate reports on an evaluation run. Reports output to the ",(0,t.jsx)(n.code,{children:"ReportStore"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Each of these actions can be run with a command from the CLI.\nFor information on the available commands, refer to the ",(0,t.jsx)(n.a,{href:"/chatbot/evaluation/command-reference",children:"CLI Commands Reference"})," documentation."]}),"\n",(0,t.jsxs)(n.p,{children:["You can also run series of commands together in a pipeline.\nTo learn more about evaluation pipelines, refer to the ",(0,t.jsx)(n.a,{href:"./pipelines.md",children:"Pipelines"})," documentation."]}),"\n",(0,t.jsx)(n.h2,{id:"install",children:"Install"}),"\n",(0,t.jsx)(n.p,{children:"To install the Evaluation CLI, run the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm i mongodb-chatbot-evaluation mongodb-chatbot-server\n"})}),"\n",(0,t.jsx)(n.h2,{id:"create-a-configuration-file",children:"Create a Configuration File"}),"\n",(0,t.jsxs)(n.p,{children:["The MongoDB Evaluation CLI uses a ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/CommonJS",children:"CommonJS"}),"\nJavaScript configuration file to determine how to evaluate content."]}),"\n",(0,t.jsxs)(n.p,{children:["Every configuration file must export a ",(0,t.jsx)(n.a,{href:"/chatbot/reference/eval/modules#configconstructor",children:(0,t.jsx)(n.code,{children:"ConfigConstructor"})})," object as its default export."]}),"\n",(0,t.jsx)(n.p,{children:"You must either:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Pass the path to a configuration file to every command with the ",(0,t.jsx)(n.code,{children:"--config"})," flag."]}),"\n",(0,t.jsxs)(n.li,{children:["Put a CommonJS file named ",(0,t.jsx)(n.code,{children:"eval.config.js"})," in the root of your project."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["For example, to run the ",(0,t.jsx)(n.code,{children:"generate"})," command with a configuration file called ",(0,t.jsx)(n.code,{children:"my-eval.config.js"})," and generation called ",(0,t.jsx)(n.code,{children:"my-conversations"}),", run the following command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mongodb-chatbot-evaluation generate --config my-eval.config.js --name my-conversations\n"})}),"\n",(0,t.jsx)(n.h2,{id:"define-configuration-files-with-typescript",children:"Define Configuration Files with TypeScript"}),"\n",(0,t.jsx)(n.admonition,{title:"Use TypeScript Configuration Files!",type:"important",children:(0,t.jsxs)(n.p,{children:["We ",(0,t.jsx)(n.strong,{children:"strongly"})," recommend using TypeScript configuration files.\nThe typing system helps you ensure that your configuration is valid."]})}),"\n",(0,t.jsx)(n.p,{children:"You can use TypeScript to make your configuration file. This allows you to use\nthe type system to ensure that your configuration is valid."}),"\n",(0,t.jsxs)(n.p,{children:["You must compile your configuration file to ",(0,t.jsx)(n.strong,{children:"CommmonJS"})," before running the CLI.\nThe CLI only accepts CommonJS configuration files."]}),"\n",(0,t.jsxs)(n.p,{children:["You can build your CommonJS configuration file with ",(0,t.jsx)(n.code,{children:"tsc"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"tsc --module commonjs --target es2017 --outDir build eval.config.ts\n"})}),"\n",(0,t.jsx)(n.p,{children:"Then run the Evaluation CLI with the compiled configuration file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mongodb-chatbot-evaluation generate --config build/eval.config.js --name my-conversations\n"})}),"\n",(0,t.jsx)(n.h2,{id:"example-configuration",children:"Example Configuration"}),"\n",(0,t.jsx)(n.p,{children:"Here's a simple example configuration file for the Evaluation CLI.\nYou can use this configuration file as a starting point for your own configuration."}),"\n",(0,t.jsx)(n.p,{children:"Example configuration file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// eval.config.ts\n\nimport {\n  EvalConfig,\n  makeMongoDbCommandMetadataStore,\n  makeMongoDbGeneratedDataStore,\n  makeGenerateConversationData,\n  getConversationsTestCasesFromYaml,\n  makeEvaluateConversationQuality,\n  makeMongoDbEvaluationStore,\n  makeMongoDbReportStore,\n  mongodbResponseQualityExamples,\n  reportStatsForBinaryEvalRun,\n  makeEvaluateConversationFaithfulness,\n} from "mongodb-chatbot-evaluation";\nimport { makeMongoDbConversationsService } from "mongodb-chatbot-server";\nimport "dotenv/config";\nimport fs from "fs";\nimport path from "path";\nimport { MongoClient, assertEnvVars } from "mongodb-rag-core";\nimport { envVars } from "./envVars";\n\nexport default async () => {\n  const {\n    MONGODB_DATABASE_NAME,\n    MONGODB_CONNECTION_URI,\n    CONVERSATIONS_SERVER_BASE_URL,\n    OPENAI_CHAT_COMPLETION_DEPLOYMENT,\n    OPENAI_ENDPOINT,\n    OPENAI_API_KEY,\n    OPENAI_GPT_4_CHAT_COMPLETION_DEPLOYMENT,\n  } = assertEnvVars(envVars);\n\n  const { OpenAIClient, AzureKeyCredential } = await import("@azure/openai");\n  const { OpenAI: LlamaIndexOpenAiLlm } = await import("llamaindex");\n  const miscTestCases = getConversationsTestCasesFromYaml(\n    fs.readFileSync(\n      path.resolve(__dirname, "..", "testCases", "conversations.yml"),\n      "utf8"\n    )\n  );\n  const faqTestCases = getConversationsTestCasesFromYaml(\n    fs.readFileSync(\n      path.resolve(__dirname, "..", "testCases", "faq_conversations.yml"),\n      "utf8"\n    )\n  );\n\n  const storeDbOptions = {\n    connectionUri: MONGODB_CONNECTION_URI,\n    databaseName: MONGODB_DATABASE_NAME,\n  };\n\n  const mongodb = new MongoClient(MONGODB_CONNECTION_URI);\n  await mongodb.connect();\n\n  const db = mongodb.db(MONGODB_DATABASE_NAME);\n  const conversations = makeMongoDbConversationsService(db);\n\n  const evalConfig = {\n    metadataStore: makeMongoDbCommandMetadataStore(storeDbOptions),\n    generatedDataStore: makeMongoDbGeneratedDataStore(storeDbOptions),\n    evaluationStore: makeMongoDbEvaluationStore(storeDbOptions),\n    reportStore: makeMongoDbReportStore(storeDbOptions),\n\n    commands: {\n      generate: {\n        conversations: {\n          type: "conversation",\n          testCases: [...miscTestCases, ...faqTestCases],\n          generator: makeGenerateConversationData({\n            conversations,\n            httpHeaders: {\n              Origin: "Testing",\n            },\n            apiBaseUrl: CONVERSATIONS_SERVER_BASE_URL,\n          }),\n        },\n        faqConversations: {\n          type: "conversation",\n          testCases: faqTestCases,\n          generator: makeGenerateConversationData({\n            conversations,\n            httpHeaders: {\n              Origin: "Testing",\n            },\n            apiBaseUrl: CONVERSATIONS_SERVER_BASE_URL,\n          }),\n        },\n      },\n      evaluate: {\n        conversationQuality: {\n          evaluator: makeEvaluateConversationQuality({\n            deploymentName: OPENAI_CHAT_COMPLETION_DEPLOYMENT,\n            openAiClient: new OpenAIClient(\n              OPENAI_ENDPOINT,\n              new AzureKeyCredential(OPENAI_API_KEY)\n            ),\n            fewShotExamples: mongodbResponseQualityExamples,\n          }),\n        },\n        conversationFaithfulness: {\n          evaluator: makeEvaluateConversationFaithfulness({\n            llamaIndexLlm: new LlamaIndexOpenAiLlm({\n              azure: {\n                apiKey: OPENAI_API_KEY,\n                endpoint: OPENAI_ENDPOINT,\n                deploymentName: OPENAI_GPT_4_CHAT_COMPLETION_DEPLOYMENT,\n              },\n            }),\n          }),\n        },\n      },\n      report: {\n        conversationQualityRun: {\n          reporter: reportStatsForBinaryEvalRun,\n        },\n        conversationFaithfulnessRun: {\n          reporter: reportStatsForBinaryEvalRun,\n        },\n      },\n    },\n    async afterAll() {\n      await mongodb.close();\n    },\n  } satisfies EvalConfig;\n  return evalConfig;\n};\n'})}),"\n",(0,t.jsx)(n.h2,{id:"additional-example-configurations",children:"Additional Example Configurations"}),"\n",(0,t.jsx)(n.p,{children:"For additional example configurations, check out the following projects:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://github.com/mongodb/chatbot/blob/main/packages/chatbot-eval-mongodb-public/src/eval.config.ts",children:"MongoDB AI chatbot evaluation"}),": Evaluations for the MongoDB AI chatbot."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,n,o)=>{o.d(n,{Z:()=>s,a:()=>r});var t=o(67294);const a={},i=t.createContext(a);function r(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);